# List of commands that will be run before `setup_commands`. If docker is
# enabled, these commands will run outside the container and before docker
# is setup.
initialization_commands: []

# Docker configurations
docker:
    # Initialization commands running on host for only docker enabled
    initialization_commands:
        - which docker || (curl -fsSL https://get.docker.com -o /tmp/get-docker.sh &&
          sudo bash /tmp/get-docker.sh > /dev/null && sudo usermod -aG docker $USER && sudo systemctl restart docker -f)

# List of shell commands to run to set up nodes.
setup_commands:
    - >-
        which conda || (wget -q --show-progress "https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh" -O /tmp/miniconda.sh &&
        /bin/bash /tmp/miniconda.sh -b -u -p ~/anaconda3  &&  ~/anaconda3/bin/conda init  && rm -rf /tmp/miniconda.sh)
    - conda activate cloudtik_py37 || conda create -n cloudtik_py37 -y python=3.7
    - (stat $HOME/anaconda3/envs/cloudtik_py37/ &> /dev/null &&
        echo 'export PATH="$HOME/anaconda3/envs/cloudtik_py37/bin:$PATH"' >> ~/.bashrc) || true

# Command to start on the head node. You don't need to change this.
head_start_commands:
    - cloudtik node-stop
    - cloudtik-spark stop-head
    - cloudtik-spark start-head
    - ulimit -n 65536; cloudtik node-start --head --port=6789 --cluster-scaling-config=~/cloudtik_bootstrap_config.yaml

# Command to start on worker nodes. You don't need to change this.
worker_start_commands:
    - cloudtik node-stop
    - cloudtik-spark stop-worker
    - cloudtik-spark start-worker
    - ulimit -n 65536; cloudtik node-start --address=$CLOUDTIK_HEAD_IP:6789

# Command to start on the head node. You don't need to change this.
head_stop_commands:
    - cloudtik node-stop
    - cloudtik-spark stop-head

# Command to start on worker nodes. You don't need to change this.
worker_stop_commands:
    - cloudtik node-stop
    - cloudtik-spark stop-worker
